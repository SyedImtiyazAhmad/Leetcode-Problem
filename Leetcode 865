import java.util.*;

class Solution {

    public List<TreeNode> deepestNodes(TreeNode root) {
        Queue<TreeNode> q = new LinkedList<>();
        q.add(root);

        List<TreeNode> deepest = new ArrayList<>();

        while (!q.isEmpty()) {
            int size = q.size();
            deepest = new ArrayList<>();

            while (size > 0) {
                size--;
                TreeNode node = q.poll();
                deepest.add(node);

                if (node.left != null)
                    q.add(node.left);

                if (node.right != null)
                    q.add(node.right);
            }
        }
        return deepest;
    }

    public TreeNode lca(TreeNode root, TreeNode p, TreeNode q) {
        if (root == null || root == p || root == q)
            return root;

        TreeNode left = lca(root.left, p, q);
        TreeNode right = lca(root.right, p, q);

        if (left != null && right != null)
            return root;

        return (left != null) ? left : right;
    }

    public TreeNode subtreeWithAllDeepest(TreeNode root) {
        List<TreeNode> deep = deepestNodes(root);
        return lca(root, deep.get(0), deep.get(deep.size() - 1));
    }
}
